{"version":3,"sources":["webpack:///./src/views/user/Login.vue?ee45","webpack:///./src/views/user/Login.vue","webpack:///./src/views/user/Login.vue?8930"],"names":["_hoisted_1","class","_defineComponent","__name","setup","__props","user","loginState","storeToRefs","useDashboardStore","login","sdk","loginWithRedirect","redirect","inviteId","localStorage","getItem","removeItem","router","push","path","name","getLoginState","async","res","value","accessToken","Error","saveUserInfo2store","checkLoginState","isRedirectCallback","callback","handleRedirectCallback","token","idToken","setItem","userInfo","getUserInfo","onMounted","_ctx","_cache","_openBlock","_createElementBlock","__exports__"],"mappings":"2IAAA,W,mHCGA,MACMA,EAAa,CAAEC,MAAO,cAQAC,mCAAiB,CAC3CC,OAAQ,QACRC,MAAMC,GAER,MAAM,KAAEC,EAAF,WAAQC,GAAeC,eAAYC,kBAEnCC,EAAQ,KACZC,OAAIC,qBAGN,SAASC,IAEP,MAAMC,EAAWC,aAAaC,QAAQ,YACtC,GAAIF,EAKF,OAJAC,aAAaE,WAAW,iBACxBC,OAAOC,KAAK,CACVC,KAAM,cAAcN,IAIxBI,OAAOC,KAAK,CACVE,KAAM,SAIV,MAAMC,EAAgBC,UACpB,IACE,MAAMC,QAAYb,OAAIW,gBAEtB,GADAf,EAAWkB,MAAQD,EACf,OAACA,QAAD,IAACA,MAAKE,YACR,MAAM,IAAIC,MAGVC,IACAf,IAGJ,MACEH,MAQJa,eAAeM,IACb,IAAKlB,OAAImB,qBAEP,YADKR,IAGP,MAAMS,QAAiBpB,OAAIqB,yBAC3BzB,EAAWkB,MAAQM,EACnB,IAAIE,EAAQ,GACZ,OAAIF,QAAJ,IAAIA,KAAUG,UACZD,EAAQF,EAASG,QACjBnB,aAAaoB,QAAQ,QAASF,UAE1BL,IACNf,IAGFU,eAAeK,IACb,IACE,MAAMQ,QAAiBzB,OAAI0B,cACvBD,IACF9B,EAAKmB,MAAQW,GAGjB,MACE1B,KAIJ,OAhCA4B,uBAAU,KACHT,MA+BA,CAACU,EAAUC,KACRC,yBAAcC,gCAAoB,MAAO1C,EAAY,oB,iCCjF/D,MAAM2C,EAA2B,IAAgB,EAAQ,CAAC,CAAC,YAAY,qBAExD","file":"js/chunk-3da8ca44.b3af0c07.js","sourcesContent":["export * from \"-!../../../node_modules/.pnpm/mini-css-extract-plugin@0.9.0_webpack@4.46.0/node_modules/mini-css-extract-plugin/dist/loader.js??ref--9-oneOf-1-0!../../../node_modules/.pnpm/css-loader@3.6.0_webpack@4.46.0/node_modules/css-loader/dist/cjs.js??ref--9-oneOf-1-1!../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/stylePostLoader.js!../../../node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??ref--9-oneOf-1-2!../../../node_modules/.pnpm/sass-loader@8.0.2_sass@1.54.5/node_modules/sass-loader/dist/cjs.js??ref--9-oneOf-1-3!../../../node_modules/.pnpm/cache-loader@4.1.0_webpack@4.46.0/node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/index.js??ref--1-1!./Login.vue?vue&type=style&index=0&id=b9d69db2&lang=scss&scoped=true\"","import { defineComponent as _defineComponent } from 'vue'\nimport { openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-b9d69db2\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"login-page\" }\n\nimport { onMounted } from 'vue'\nimport { useDashboardStore } from '@/store'\nimport { storeToRefs } from 'pinia'\nimport { sdk } from '@/utils/authing'\nimport router from '../router'\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'Login',\n  setup(__props) {\n\nconst { user, loginState } = storeToRefs(useDashboardStore())\n\nconst login = () => {\n  sdk.loginWithRedirect()\n}\n\nfunction redirect() {\n  // 判断邀请链接\n  const inviteId = localStorage.getItem('inviteId')\n  if (inviteId) {\n    localStorage.removeItem('inviteId')\n    router.push({\n      path: `/join-team/${inviteId}`\n    })\n    return\n  }\n  router.push({\n    name: 'home'\n  })\n}\n\nconst getLoginState = async () => {\n  try {\n    const res = await sdk.getLoginState()\n    loginState.value = res\n    if (!res?.accessToken) {\n      throw new Error()\n    }\n    else {\n      saveUserInfo2store()\n      redirect()\n    }\n  }\n  catch {\n    login()\n  }\n}\n\nonMounted(() => {\n  void checkLoginState()\n})\n\nasync function checkLoginState() {\n  if (!sdk.isRedirectCallback()) {\n    void getLoginState()\n    return\n  }\n  const callback = await sdk.handleRedirectCallback()\n  loginState.value = callback\n  let token = ''\n  if (callback?.idToken) {\n    token = callback.idToken\n    localStorage.setItem('token', token)\n  }\n  await saveUserInfo2store()\n  redirect()\n}\n\nasync function saveUserInfo2store() {\n  try {\n    const userInfo = await sdk.getUserInfo()\n    if (userInfo) {\n      user.value = userInfo\n    }\n  }\n  catch {\n    login()\n  }\n}\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, \" 跳转中，请稍后... \"))\n}\n}\n\n})","import script from \"./Login.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./Login.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./Login.vue?vue&type=style&index=0&id=b9d69db2&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/ken/workspace/PPTist/node_modules/.pnpm/vue-loader@16.8.3_5vqgdkn543z7gobmtemdwwisxa/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-b9d69db2\"]])\n\nexport default __exports__"],"sourceRoot":""}